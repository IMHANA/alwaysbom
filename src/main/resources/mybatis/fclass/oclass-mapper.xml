<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oclass">
    <insert id="addOclass" parameterType="com.flo.alwaysbom.fclass.vo.OclassVo">
        INSERT INTO OCLASS
        VALUES (NULL, #{memberId}, #{regCount}, #{payType},
                #{payTotal},
                <if test="payType.equals('무통장입금')">NULL</if>
                <if test="!payType.equals('무통장입금')">SYSDATE</if>
                , #{discountGrade}, #{discountPoint},
        #{fclassName}, #{branchName}, #{branchAddr}, #{fclassImage}, #{scheduleDate},
        #{scheduleStartTime}, #{scheduleEndTime}, #{fclassCount}, #{status}, #{reviewCheck}, #{discountTotalPrice}, #{fclassIdx})
    <selectKey keyProperty="idx" resultType="int" order="AFTER">
        SELECT OCLASS_SEQ.currval FROM DUAL
    </selectKey>
    </insert>

    <select id="findBySearchOption" parameterType="com.flo.alwaysbom.fclass.vo.OclassSearchOptionDto"
            resultType="com.flo.alwaysbom.fclass.vo.OclassVo">
        SELECT * FROM OCLASS
        <where>
            MEMBER_ID = #{memberId}
            <if test="status != null and !status.equals('전체')">
                AND STATUS = #{status}
            </if>
            <if test="className != null">
                AND FCLASS_NAME LIKE '%' || #{className} || '%'
            </if>
        </where>
        ORDER BY IDX DESC
    </select>

<!--    <select id="searchSchedule" parameterType="com.flo.alwaysbom.fclass.vo.ScheduleVo" resultType="com.flo.alwaysbom.fclass.vo.ScheduleVo">
        SELECT * FROM SCHEDULE
        WHERE FCLASS_IDX = #{fclassIdx} AND BRANCH_IDX = #{branchIdx} AND SDATE >= SYSDATE
            <if test="sdate != null">
            AND TO_CHAR(SDATE, 'YYYY-MM-DD') = TO_CHAR(#{sdate}, 'YYYY-MM-DD')
            </if>
        ORDER BY SDATE
    </select>

    <select id="findByIdx" parameterType="int" resultType="com.flo.alwaysbom.fclass.vo.ScheduleVo">
        SELECT * FROM SCHEDULE
        WHERE IDX=#{idx}
    </select>

    <delete id="deleteSchedule" parameterType="list">
        DELETE FROM SCHEDULE WHERE IDX IN
        <foreach collection="list" item="idx" open="(" separator="," close=")" >
           #{idx}
        </foreach>
    </delete>
&lt;!&ndash; DELETE FROM SCHEDULE WHERE IDX in (1, 3, 5, 6, 7) : idx가 1,3,5,6,7 인 것들을 지워라&ndash;&gt;

    <update id="updateSchedule" parameterType="com.flo.alwaysbom.fclass.vo.ScheduleVo">
        UPDATE SCHEDULE
        SET SDATE = #{sdate}, START_TIME = #{startTime}, END_TIME = #{endTime},
            TOTAL_COUNT = #{totalCount}
        WHERE IDX = #{idx}
    </update>-->

</mapper>