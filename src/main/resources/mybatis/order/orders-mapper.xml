<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orders-mapper">

    <select id="findDelivery" parameterType="com.flo.alwaysbom.member.vo.MemberVO" resultType="com.flo.alwaysbom.order.vo.DeliveryInfoVo">
        SELECT RECEIVER_NAME, RECEIVER_PHONE, RECEIVER_ZIPCODE, RECEIVER_ADDR_BASE,
               RECEIVER_ADDR_DETAIL, RECEIVER_ADDR_EXTRA
        FROM DELIVERY_INFO
        WHERE MEMBER_ID = #{id}
    </select>

    <select id="getPoint" parameterType="com.flo.alwaysbom.member.vo.MemberVO" resultType="int">
        SELECT POINT FROM MEMBER WHERE ID = #{id}
    </select>


    <insert id="insertOrder" parameterType="com.flo.alwaysbom.order.vo.OrdersVo">
        INSERT INTO ORDERS
        VALUES(NULL, #{memberId}, SYSDATE, #{receiverName}, #{receiverPhone}, #{receiverZipcode}, #{receiverAddrBase},
                    #{receiverAddrDetail}, #{receiverAddrExtra}, #{senderName}, #{payType}, #{payTotal}, #{payDelivery},
                    SYSDATE, #{discountGrade}, #{discountPoint})
        <selectKey keyProperty="idx" order="AFTER" resultType="int">
            SELECT ORDERS_SEQ.CURRVAL FROM DUAL
        </selectKey>
    </insert>

    <insert id="insertOitem" parameterType="com.flo.alwaysbom.order.vo.OitemVo">
        INSERT INTO OITEM VALUES(NULL, #{ordersIdx}, #{letterContent}, #{name}, #{price},
                                 #{options}, #{image}, #{status}, #{requestDate},
                                 #{deliveryStartDate}, #{category}, #{reviewCheck}, #{quantity})
        <selectKey keyProperty="idx" order="AFTER" resultType="int">
            select OITEM_SEQ.currval from dual
        </selectKey>
    </insert>

    <insert id="saveDelivery" parameterType="com.flo.alwaysbom.order.vo.OrdersVo">
        INSERT INTO DELIVERY_INFO
        VALUES(NULL, #{memberId}, #{receiverName}, #{receiverPhone}, #{receiverZipcode},
                    #{receiverAddrBase}, #{receiverAddrDetail}, #{receiverAddrExtra})

    </insert>


</mapper>